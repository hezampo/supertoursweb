<?php/** * Description of TripsController *Actualizado por Ing. Arturo Bustamante Madariaga [2016-2018] *  */Doo::loadController('I18nController');class RoutesController extends I18nController {    public function beforeRun($resource, $action) {        if (!isset($_SESSION['login'])) {            return Doo::conf()->APP_URL;        }    }    public function index() {        // Cargamos el paginador        Doo::loadHelper('DooPager');        if (!isset($this->params['type_rate'])) {            $type_rate = "0";        } else {            $type_rate = $this->params['type_rate'];        }        if (!isset($_POST["id_agencya"])) {            if (!isset($this->params['id_agency'])) {                $id_agency = "-1";            } else {                $id_agency = $this->params['id_agency'];            }        } else {            $id_agency = $_POST["id_agencya"];        }        if (!isset($_POST["acompany"])) {            if (!isset($this->params['acompany'])) {                $acompany = "";            } else {                $acompany = $this->params['acompany'];            }        } else {            $acompany = $_POST["acompany"];        }        if (!isset($_POST["filtro"])) {            if (!isset($this->params['filtro'])) {                $filtro = "trip_no";            } else {                $filtro = $this->params['filtro'];            }        } else {            $filtro = $_POST["filtro"];        }        if (!isset($_POST["texto"])) {            if (!isset($this->params['texto'])) {                $texto = "";            } else {                $texto = $this->params['texto'];            }        } else {            $texto = $_POST["texto"];        }//        if ($type_rate == 2) {////            $from = "from routes_net t1 ////                      left join areas t2 ON (t1.trip_from = t2.id)////                      LEFT JOIN areas t3 ON (t1.trip_to = t3.id)////                      left join agencia t4 ON (t1.id_agency = t4.id)";//        } else {////            $from = "from routes t1 ////                      left join areas t2 ON (t1.trip_from = t2.id)////                      LEFT JOIN areas t3 ON (t1.trip_to = t3.id)";//        }//        if ($type_rate == 2 && $id_agency == "-1") {////            $where = "t1.type_rate=" . $type_rate . " and " . $filtro . " like ?  ";////            $param = array($texto . '%');////            $rs = Doo::db()->query("select COUNT(*) " . $from . " where " . $where, $param);//        } else {////            $where = "t1.type_rate=" . $type_rate . " and id_agency = ? and " . $filtro . " like ?  ";////            $param = array($id_agency, $texto . '%');////            $rs = Doo::db()->query("select COUNT(*) " . $from . " where " . $where, $param);//        }////////////        $total = $rs->fetchColumn();////////        if ($total == 0)//            $total = 1;////        // iniciamos el paginador////////        $pager = new DooPager(Doo::conf()->APP_URL . "admin/routes/$filtro/$texto/$type_rate/$id_agency/$acompany/page", $total, 6, 5);////////        if (isset($this->params['pindex']))//            $pager->paginate(intval($this->params['pindex']));//        else//            $pager->paginate(1);//        $sql = "select distinct t1.id, t1.trip_no, t2.nombre AS trip_from, t3.nombre AS trip_to, t1.stprc_adult, t1.stprc_child, t1.sflexprc_child, t1.sflexprc_adult, t1.trip_departure,////                       " . (($type_rate == 2) ? "t4.company_name," : "") . "////                       t1.trip_arrival,t1.fecha_ini, t1.fecha_fin, t1.type_rate " . $from . " where  " . $where . "  Order By fecha_ini  and trip_no desc limit " . $pager->limit;        $sql = "SELECT DISTINCT trip_no FROM routes WHERE trip_from='1' AND trip_to = '3' OR trip_from='3' AND trip_to='2' ORDER BY trip_no" . $pager->limit;//      $rs = Doo::db()->query($sql, $param);        $rs = Doo::db()->query($sql);        $trips = $rs->fetchAll();        $this->data['rootUrl'] = Doo::conf()->APP_URL;        $this->data['content'] = 'configuracion/matrix.php';        $this->data['type_rate'] = $type_rate;        $this->data['texto'] = $texto;        $this->data['id_agency'] = $id_agency;        $this->data['acompany'] = $acompany;        $this->data['filtro'] = $filtro;        $this->data['trips'] = $trips;        $this->data['pager'] = $pager->output;        $this->renderc('admin/index', $this->data, true);    }    public function add() {        Doo::loadModel("Routes");        $trip = new Routes();        $this->data['rootUrl'] = Doo::conf()->APP_URL;        $this->data['trip'] = $trip;        $this->data['areas'] = Doo::db()->find("Areas", array("asArray" => true));        $this->data['tripsnumber'] = Doo::db()->find("Trips", array("asArray" => true));//        $this->data['content'] = 'configuracion/frm_route.php';        $this->data['content'] = 'configuracion/frm_rates1.php';        $this->data['dato'] = "New";        $this->renderc('admin/index', $this->data);    }    public function add_Net_especial() {        Doo::loadModel("Routes_Net");        $trip = new Routes_Net();        $this->data['rootUrl'] = Doo::conf()->APP_URL;        $this->data['trip'] = $trip;        $this->data['areas'] = Doo::db()->find("Areas", array("asArray" => true));        $this->data['tripsnumber'] = Doo::db()->find("Trips", array("asArray" => true));        $this->data['content'] = "configuracion/frm_rates2.php";        Doo::loadModel("Routes");        $routes = new Routes_Net();        $this->data["routes"] = $routes;        $this->renderc('admin/index', $this->data);    }//    function devuelveArrayFechasEntreOtrasDos($fechaInicio, $fechaFin){//        $arrayFechas=array();//        $fechaMostrar = $fechaInicio;////        while(strtotime($fechaMostrar) <= strtotime($fechaFin)) {//        $arrayFechas[]=$fechaMostrar;//        $fechaMostrar = date("d-m-Y", strtotime($fechaMostrar . " + 1 day"));//        }////        return $arrayFechas;//        }     public function specialTransport() {        $special_name = $this->params['special_price_name'];        // echo 'hola mundo';        //$this->data['special_name'] = 'hola mundo';        //$type_rate = 2;        $this->renderc('admin/matrix', $this->data);        //return Doo::conf()->APP_URL . "admin/routes/" . $type_rate;    }    public function save() {        Doo::loadModel("Routes");        Doo::loadModel("Routes_Net");                       if ($_POST['type_rate'] == 2) {            $trip = new Routes_Net($_POST);                        $new = false;            $this->data['rootUrl'] = Doo::conf()->APP_URL;            $trip_nro = $_POST['trip_nro'];            $spname = $_POST['acompany'];                     //$this->data['acompany'] = $spname;            //echo $trip_nro;            if ($trip_nro == 100 || $trip_nro == 200 || $trip_nro == 300 || $trip_nro == 101 || $trip_nro == 201 || $trip_nro == 301) {                $d1 = $_POST['d1'];                $fecha_inicial = $_POST['fecha_ini1'];                $fecha_final = $_POST['fecha_fin1'];//        echo $fecha_inibus;//        echo $fecha_finbus;//        exit();                //dia 1                 $prcnet_adult = $_POST['prcnet_adult'];                $prcnet_child = $_POST['prcnet_child'];                $univext = $_POST['univext'];                $wdext = $_POST['wdext'];                //de Orlando a sus respectivas areas                $f1t3 = $_POST['f1t3'];                $f1t4 = $_POST['f1t4'];                $f1t5 = $_POST['f1t5'];                $f1t6 = $_POST['f1t6'];                $f1t7 = $_POST['f1t7'];                $f1t8 = $_POST['f1t8'];                $f1t9 = $_POST['f1t9'];                $f1t10 = $_POST['f1t10'];                $f1t19 = $_POST['f1t19'];                $f1t11 = $_POST['f1t11'];                $f1t12 = $_POST['f1t12'];                $f1t13 = $_POST['f1t13'];                $f1t14 = $_POST['f1t14'];                //de Kissimmee a sus respectivas areas                $f2t3 = $_POST['f2t3'];                $f2t4 = $_POST['f2t4'];                $f2t5 = $_POST['f2t5'];                $f2t6 = $_POST['f2t6'];                $f2t7 = $_POST['f2t7'];                $f2t8 = $_POST['f2t8'];                $f2t9 = $_POST['f2t9'];                $f2t10 = $_POST['f2t10'];                $f2t19 = $_POST['f2t19'];                $f2t11 = $_POST['f2t11'];                $f2t12 = $_POST['f2t12'];                $f2t13 = $_POST['f2t13'];                $f2t14 = $_POST['f2t14'];                //de Fort Pierce a sus respectivas areas                $f3t4 = $_POST['f3t4'];                $f3t5 = $_POST['f3t5'];                $f3t6 = $_POST['f3t6'];                $f3t7 = $_POST['f3t7'];                $f3t8 = $_POST['f3t8'];                $f3t9 = $_POST['f3t9'];                $f3t10 = $_POST['f3t10'];                $f3t19 = $_POST['f3t19'];                $f3t11 = $_POST['f3t11'];                $f3t12 = $_POST['f3t12'];                $f3t13 = $_POST['f3t13'];                $f3t14 = $_POST['f3t14'];                //de Lake$_POSTorth a sus respectivas areas                $f4t5 = $_POST['f4t5'];                $f4t6 = $_POST['f4t6'];                $f4t7 = $_POST['f4t7'];                $f4t8 = $_POST['f4t8'];                $f4t9 = $_POST['f4t9'];                $f4t10 = $_POST['f4t10'];                $f4t19 = $_POST['f4t19'];                $f4t11 = $_POST['f4t11'];                $f4t12 = $_POST['f4t12'];                $f4t13 = $_POST['f4t13'];                $f4t14 = $_POST['f4t14'];                //de  Fort Lauderdale a sus respectivas areas                $f5t6 = $_POST['f5t6'];                $f5t7 = $_POST['f5t7'];                $f5t8 = $_POST['f5t8'];                $f5t9 = $_POST['f5t9'];                $f5t10 = $_POST['f5t10'];                $f5t19 = $_POST['f5t19'];                $f5t11 = $_POST['f5t11'];                $f5t12 = $_POST['f5t12'];                $f5t13 = $_POST['f5t13'];                $f5t14 = $_POST['f5t14'];            } else {                //echo "hola mundo";            }//        echo '<pre>';//        print_r($datos);//        exit();//        echo '</pre>';            $fecha_iniforma = $fecha_inicial;            $fecha_iniforma2 = $fecha_final;            if ($new) {                Doo::db()->insert($trip);            } else {                //Doo::db()->update($trip);                if ($trip_nro == 100 || $trip_nro == 200) {                    $sql = "SELECT * FROM  routes_net  WHERE fecha_ini between '$fecha_iniforma' AND '$fecha_final' AND trip_no = '$trip_nro'  AND special_price_name = '$spname' AND type_rate = 2 AND trip_from = 1 AND trip_to = 3 ";                    $rs = Doo::db()->query($sql);                    $trips = $rs->fetchAll();                    $num = count($trips);                }                if ($trip_nro == 301) {                    $sql = "SELECT * FROM  routes_net  WHERE fecha_ini between '$fecha_iniforma' AND '$fecha_final' AND trip_no = '$trip_nro'  AND special_price_name = '$spname' AND type_rate = 2 AND trip_from = 3 AND trip_to = 1 ";                    $rs = Doo::db()->query($sql);                    $trips = $rs->fetchAll();                    $num = count($trips);                }                if ($trip_nro == 101 || $trip_nro == 201) {                    $sql = "SELECT * FROM  routes_net  WHERE fecha_ini between '$fecha_iniforma' AND '$fecha_final' AND trip_no = '$trip_nro'  AND special_price_name = '$spname' AND type_rate = 2 AND trip_from = 3 AND trip_to = 1 ";                    $rs = Doo::db()->query($sql);                    $trips = $rs->fetchAll();                    $num = count($trips);                }                if ($trip_nro == 300) {                    $sql = "SELECT * FROM  routes_net  WHERE fecha_ini between '$fecha_iniforma' AND '$fecha_final' AND trip_no = '$trip_nro'  AND special_price_name = '$spname' AND type_rate = 2 AND trip_from = 1 AND trip_to = 3 ";                    $rs = Doo::db()->query($sql);                    $trips = $rs->fetchAll();                    $num = count($trips);                }//           echo '<pre>';////////                print_r($capacity);////////                print_r($vehicles);//              print_r($num);//////              print_r($fecha_iniforma2);//////              print_r($fecha_iniforma3);////              //              echo '</pre>';//              exit();                  if ($num == 0) {                    Doo::db()->insert($routes);                } else {                              if ($trip_nro == 100 || $trip_nro == 200) {                        //dia 1                        //de Orlando a las demas areas                        if ($d1 == 1) {                                                        Doo::db()->query("UPDATE routes_net SET  prcnet_adult='$prcnet_adult', prcnet_child='$prcnet_child', univext='$univext', wdext='$wdext', f1t3='$f1t3', f1t4='$f1t4', f1t5='$f1t5', f1t6='$f1t6', f1t7='$f1t7', f1t8='$f1t8', f1t9='$f1t9', f1t10='$f1t10', f1t19='$f1t19', f1t11='$f1t12', f1t12='$f1t11', f1t13='$f1t13', f1t14='$f1t14', f2t3='$f2t3', f2t4='$f2t4', f2t5='$f2t5', f2t6='$f2t6', f2t7='$f2t7', f2t8='$f2t8', f2t9='$f2t9', f2t10='$f2t10', f2t19='$f2t19', f2t11='$f2t12', f2t12='$f2t11', f2t13='$f2t13', f2t14='$f2t14', f3t4='$f3t4', f3t5='$f3t5', f3t6='$f3t6', f3t7='$f3t7', f3t8='$f3t8', f3t9='$f3t9', f3t10='$f3t10', f3t19='$f3t19', f3t11='$f3t12', f3t12='$f3t11', f3t13='$f3t13', f3t14='$f3t14', f4t5='$f4t5', f4t6='$f4t6', f4t7='$f4t7', f4t8='$f4t8', f4t9='$f4t9', f4t10='$f4t10', f4t19='$f4t19', f4t11='$f4t12', f4t12='$f4t11', f4t13='$f4t13', f4t14='$f4t14', f5t6='$f5t6', f5t7='$f5t7', f5t8='$f5t8', f5t9='$f5t9', f5t10='$f5t10', f5t19='$f5t19', f5t11='$f5t12', f5t12='$f5t11', f5t13='$f5t13', f5t14='$f5t14'  WHERE fecha_ini >='$fecha_iniforma' AND fecha_fin <= '$fecha_iniforma2' AND trip_no = '$trip_nro' AND type_rate = '2' AND special_price_name = '$spname'");                                                    }                }                if ($trip_nro == 300) {                        //dia 1                        //de Orlando a las demas areas                        if ($d1 == 1) {                           Doo::db()->query("UPDATE routes_net SET  prcnet_adult='$prcnet_adult', prcnet_child='$prcnet_child', univext='$univext', wdext='$wdext', f1t3='$f1t3', f1t4='$f1t4', f1t5='$f1t5', f1t6='$f1t6', f1t7='$f1t7', f1t8='$f1t8', f1t9='$f1t9', f1t10='$f1t10', f1t19='$f1t19', f1t11='$f1t12', f1t12='$f1t11', f1t13='$f1t13', f1t14='$f1t14', f2t3='$f2t3', f2t4='$f2t4', f2t5='$f2t5', f2t6='$f2t6', f2t7='$f2t7', f2t8='$f2t8', f2t9='$f2t9', f2t10='$f2t10', f2t19='$f2t19', f2t11='$f2t12', f2t12='$f2t11', f2t13='$f2t13', f2t14='$f2t14', f3t4='$f3t4', f3t5='$f3t5', f3t6='$f3t6', f3t7='$f3t7', f3t8='$f3t8', f3t9='$f3t9', f3t10='$f3t10', f3t19='$f3t19', f3t11='$f3t12', f3t12='$f3t11', f3t13='$f3t13', f3t14='$f3t14', f4t5='$f4t5', f4t6='$f4t6', f4t7='$f4t7', f4t8='$f4t8', f4t9='$f4t9', f4t10='$f4t10', f4t19='$f4t19', f4t11='$f4t12', f4t12='$f4t11', f4t13='$f4t13', f4t14='$f4t14', f5t6='$f5t6', f5t7='$f5t7', f5t8='$f5t8', f5t9='$f5t9', f5t10='$f5t10', f5t19='$f5t19', f5t11='$f5t12', f5t12='$f5t11', f5t13='$f5t13', f5t14='$f5t14'  WHERE fecha_ini >='$fecha_iniforma' AND fecha_fin <= '$fecha_iniforma2' AND trip_no = '$trip_nro' AND type_rate = '2' AND special_price_name = '$spname'");                                                    }                }                    //301                    //                            if ($trip_nro == 301) {                        //dia 1                        //de Orlando a las demas areas                        if ($d1 == 1) {                            Doo::db()->query("UPDATE routes_net SET  prcnet_adult='$prcnet_adult', prcnet_child='$prcnet_child', univext='$univext', wdext='$wdext', f1t3='$f1t3', f1t4='$f1t4', f1t5='$f1t5', f1t6='$f1t6', f1t7='$f1t7', f1t8='$f1t8', f1t9='$f1t9', f1t10='$f1t10', f1t19='$f1t19', f1t11='$f1t12', f1t12='$f1t11', f1t13='$f1t13', f1t14='$f1t14', f2t3='$f2t3', f2t4='$f2t4', f2t5='$f2t5', f2t6='$f2t6', f2t7='$f2t7', f2t8='$f2t8', f2t9='$f2t9', f2t10='$f2t10', f2t19='$f2t19', f2t11='$f2t12', f2t12='$f2t11', f2t13='$f2t13', f2t14='$f2t14', f3t4='$f3t4', f3t5='$f3t5', f3t6='$f3t6', f3t7='$f3t7', f3t8='$f3t8', f3t9='$f3t9', f3t10='$f3t10', f3t19='$f3t19', f3t11='$f3t12', f3t12='$f3t11', f3t13='$f3t13', f3t14='$f3t14', f4t5='$f4t5', f4t6='$f4t6', f4t7='$f4t7', f4t8='$f4t8', f4t9='$f4t9', f4t10='$f4t10', f4t19='$f4t19', f4t11='$f4t12', f4t12='$f4t11', f4t13='$f4t13', f4t14='$f4t14', f5t6='$f5t6', f5t7='$f5t7', f5t8='$f5t8', f5t9='$f5t9', f5t10='$f5t10', f5t19='$f5t19', f5t11='$f5t12', f5t12='$f5t11', f5t13='$f5t13', f5t14='$f5t14'  WHERE fecha_ini >='$fecha_iniforma' AND fecha_fin <= '$fecha_iniforma2' AND trip_no = '$trip_nro' AND type_rate = '2' AND special_price_name = '$spname'");                                                    }//                echo "'$fecha_ini'.Actualizado";                        //dia 2                    }                if ($trip_nro == 101 || $trip_nro == 201) {                        //dia 1                        //de Orlando a las demas areas                        if ($d1 == 1) {                                                        Doo::db()->query("UPDATE routes_net SET  prcnet_adult='$prcnet_adult', prcnet_child='$prcnet_child', univext='$univext', wdext='$wdext', f1t3='$f1t3', f1t4='$f1t4', f1t5='$f1t5', f1t6='$f1t6', f1t7='$f1t7', f1t8='$f1t8', f1t9='$f1t9', f1t10='$f1t10', f1t19='$f1t19', f1t11='$f1t12', f1t12='$f1t11', f1t13='$f1t13', f1t14='$f1t14', f2t3='$f2t3', f2t4='$f2t4', f2t5='$f2t5', f2t6='$f2t6', f2t7='$f2t7', f2t8='$f2t8', f2t9='$f2t9', f2t10='$f2t10', f2t19='$f2t19', f2t11='$f2t12', f2t12='$f2t11', f2t13='$f2t13', f2t14='$f2t14', f3t4='$f3t4', f3t5='$f3t5', f3t6='$f3t6', f3t7='$f3t7', f3t8='$f3t8', f3t9='$f3t9', f3t10='$f3t10', f3t19='$f3t19', f3t11='$f3t12', f3t12='$f3t11', f3t13='$f3t13', f3t14='$f3t14', f4t5='$f4t5', f4t6='$f4t6', f4t7='$f4t7', f4t8='$f4t8', f4t9='$f4t9', f4t10='$f4t10', f4t19='$f4t19', f4t11='$f4t12', f4t12='$f4t11', f4t13='$f4t13', f4t14='$f4t14', f5t6='$f5t6', f5t7='$f5t7', f5t8='$f5t8', f5t9='$f5t9', f5t10='$f5t10', f5t19='$f5t19', f5t11='$f5t12', f5t12='$f5t11', f5t13='$f5t13', f5t14='$f5t14'  WHERE fecha_ini >='$fecha_iniforma' AND fecha_fin <= '$fecha_iniforma2' AND trip_no = '$trip_nro' AND type_rate = '2' AND special_price_name = '$spname'");                                                                 }                }                    //actualiza solo el segundo registro//                Doo::db()->query("UPDATE routes_net SET stprc_adult = '$stprc_adult2', stprc_child = '$stprc_child2' WHERE fecha_ini ='$fecha_iniforma2' AND trip_no = '$trip_no' AND type_rate = '2' AND trip_from = '1' AND trip_to = '3'");//                }                    $type_rate = $_POST['type_rate'];                    //echo '>>'.$type_rate;                    return Doo::conf()->APP_URL . "admin/routes/" . $type_rate;                }            }            ///////////////////////////////////////////////////////////////////////////////////////////////////////////            } else {            Doo::loadModel("Bus");            Doo::loadModel("Bus_Trips");            $trip = new Routes($_POST);            $new = false;            $this->data['rootUrl'] = Doo::conf()->APP_URL;            $trip_nro = $_POST['trip_nro'];            if ($trip_nro == 100 || $trip_nro == 200 || $trip_nro == 300 || $trip_nro == 101 || $trip_nro == 201 || $trip_nro == 301) {                $d1 = $_POST['d1'];                $id_trips = $_POST['idtrip'];                      $fecha_inicial = $_POST['fecha_ini1'];                $fecha_final = $_POST['fecha_fin1'];                //dia 1                 $vehicles = $_POST['vehicles'];//                $capacity = $_POST['capacity'];//                $capacity2 = $_POST['capacity2'];//                $capacity3 = $_POST['capacity3'];//                $capacity4 = $_POST['capacity4'];//                $capacity5 = $_POST['capacity5'];                $seats_remain = $_POST['seats_remain'];                $spprc_adult = $_POST['spprc_adult'];                $spprc_child = $_POST['spprc_child'];                $sdprc_adult = $_POST['sdprc_adult'];                $sdprc_child = $_POST['sdprc_child'];                $wfprc_adult = $_POST['wfprc_adult'];                $wfprc_child = $_POST['wfprc_child'];                $stprc_adult = $_POST['stprc_adult'];                $stprc_child = $_POST['stprc_child'];                $sflexprc_adult = $_POST['sflexprc_adult'];                $sflexprc_child = $_POST['sflexprc_child'];                $flresprc_adult = $_POST['flresprc_adult'];                $flresprc_child = $_POST['flresprc_child'];                $spseats = $_POST['spseats'];                $sdseats = $_POST['sdseats'];                $wfseats = $_POST['wfseats'];                $stseats = $_POST['stseats'];                $sflexseats = $_POST['sflexseats'];                $spprcseats = $_POST['spprcseats'];                $toursseats = $_POST['toursseats'];                $univext = $_POST['univext'];                $wdext = $_POST['wdext'];                //de Orlando a sus respectivas areas                $f1t3 = $_POST['f1t3'];                $f1t4 = $_POST['f1t4'];                $f1t5 = $_POST['f1t5'];                $f1t6 = $_POST['f1t6'];                $f1t7 = $_POST['f1t7'];                $f1t8 = $_POST['f1t8'];                $f1t9 = $_POST['f1t9'];                $f1t10 = $_POST['f1t10'];                $f1t19 = $_POST['f1t19'];                $f1t11 = $_POST['f1t11'];                $f1t12 = $_POST['f1t12'];                $f1t13 = $_POST['f1t13'];                $f1t14 = $_POST['f1t14'];                //de Kissimmee a sus respectivas areas                $f2t3 = $_POST['f2t3'];                $f2t4 = $_POST['f2t4'];                $f2t5 = $_POST['f2t5'];                $f2t6 = $_POST['f2t6'];                $f2t7 = $_POST['f2t7'];                $f2t8 = $_POST['f2t8'];                $f2t9 = $_POST['f2t9'];                $f2t10 = $_POST['f2t10'];                $f2t19 = $_POST['f2t19'];                $f2t11 = $_POST['f2t11'];                $f2t12 = $_POST['f2t12'];                $f2t13 = $_POST['f2t13'];                $f2t14 = $_POST['f2t14'];                //de Fort Pierce a sus respectivas areas                $f3t4 = $_POST['f3t4'];                $f3t5 = $_POST['f3t5'];                $f3t6 = $_POST['f3t6'];                $f3t7 = $_POST['f3t7'];                $f3t8 = $_POST['f3t8'];                $f3t9 = $_POST['f3t9'];                $f3t10 = $_POST['f3t10'];                $f3t19 = $_POST['f3t19'];                $f3t11 = $_POST['f3t11'];                $f3t12 = $_POST['f3t12'];                $f3t13 = $_POST['f3t13'];                $f3t14 = $_POST['f3t14'];                //de Lake$_POSTorth a sus respectivas areas                $f4t5 = $_POST['f4t5'];                $f4t6 = $_POST['f4t6'];                $f4t7 = $_POST['f4t7'];                $f4t8 = $_POST['f4t8'];                $f4t9 = $_POST['f4t9'];                $f4t10 = $_POST['f4t10'];                $f4t19 = $_POST['f4t19'];                $f4t11 = $_POST['f4t11'];                $f4t12 = $_POST['f4t12'];                $f4t13 = $_POST['f4t13'];                $f4t14 = $_POST['f4t14'];                //de  Fort Lauderdale a sus respectivas areas                $f5t6 = $_POST['f5t6'];                $f5t7 = $_POST['f5t7'];                $f5t8 = $_POST['f5t8'];                $f5t9 = $_POST['f5t9'];                $f5t10 = $_POST['f5t10'];                $f5t19 = $_POST['f5t19'];                $f5t11 = $_POST['f5t11'];                $f5t12 = $_POST['f5t12'];                $f5t13 = $_POST['f5t13'];                $f5t14 = $_POST['f5t14'];                                                if($vehicles == '1'){                    $capacity = $_POST['capacity'];                    $capacity2 = 0;                    $capacity3 = 0;                    $capacity4 = 0;                    $capacity5 = 0;                 }                                 if($vehicles == '2'){                      $capacity = $_POST['capacity'];                    $capacity2 = $_POST['capacity2'];                    $capacity3 = 0;                    $capacity4 = 0;                    $capacity5 = 0;                                    }                                 if($vehicles == '3'){                      $capacity = $_POST['capacity'];                    $capacity2 = $_POST['capacity2'];                    $capacity3 = $_POST['capacity3'];                    $capacity4 = 0;                    $capacity5 = 0;                                    }                                 if($vehicles == '4'){                      $capacity = $_POST['capacity'];                    $capacity2 = $_POST['capacity2'];                    $capacity3 = $_POST['capacity3'];                    $capacity4 = $_POST['capacity4'];                    $capacity5 = 0;                                    }                                 if($vehicles == '5'){                      $capacity = $_POST['capacity'];                    $capacity2 = $_POST['capacity2'];                    $capacity3 = $_POST['capacity3'];                    $capacity4 = $_POST['capacity4'];                    $capacity5 = $_POST['capacity5'];                                  }                                                                //                print($spprcseats);//                exit;//            $datos = array(//            $d1= $_POST['d1'],//            $trip_nro = $_POST['trip_nro'],            //            $fecha_inicial  = $_POST['fecha_ini1'],//            $fecha_final = $_POST['fecha_fin1'],//            $vehicles = $_POST['vehicles'],//            $capacity = $_POST['capacity'],//            $seats_remain = $_POST['seats_remain'],//            $spprc_adult = $_POST['spprc_adult'],//            $spprc_child = $_POST['spprc_child'],//            $sdprc_adult = $_POST['sdprc_adult'],//            $sdprc_child = $_POST['sdprc_child'],//            $wfprc_adult = $_POST['wfprc_adult'],//            $wfprc_child = $_POST['wfprc_child'],//            $stprc_adult = $_POST['stprc_adult'],//            $stprc_child = $_POST['stprc_child'],//            $sflexprc_adult = $_POST['sflexprc_adult'],//            $sflexprc_child = $_POST['sflexprc_child'],//            $flresprc_adult = $_POST['flresprc_adult'],//            $flresprc_child = $_POST['flresprc_child'],//            $spseats = $_POST['spseats'],//            $sdseats = $_POST['sdseats'],//            $wfseats = $_POST['wfseats'],//            $stseats = $_POST['stseats'],//            $sflexseats = $_POST['sflexseats'],//            $spprcseats = $_POST['spprcseats'],//            $toursseats = $_POST['toursseats'],//            $univext = $_POST['univext'],//            $wdext = $_POST['wdext'],//            //de Orlando a sus respectivas areas//            $f1t3 = $_POST['f1t3'],//            $f1t4 = $_POST['f1t4'],//            $f1t5 = $_POST['f1t5'],//            $f1t6 = $_POST['f1t6'],//            $f1t7 = $_POST['f1t7'],//            $f1t8 = $_POST['f1t8'],//            $f1t9 = $_POST['f1t9'],//            $f1t10 = $_POST['f1t10'],//            $f1t19 = $_POST['f1t19'],//            $f1t11 = $_POST['f1t11'],//            $f1t12 = $_POST['f1t12'],//            $f1t13 = $_POST['f1t13'],//            $f1t14 = $_POST['f1t14'],//            //de Kissimmee a sus respectivas areas//            $f2t3 = $_POST['f2t3'],//            $f2t4 = $_POST['f2t4'],//            $f2t5 = $_POST['f2t5'],//            $f2t6 = $_POST['f2t6'],//            $f2t7 = $_POST['f2t7'],//            $f2t8 = $_POST['f2t8'],//            $f2t9 = $_POST['f2t9'],//            $f2t10 = $_POST['f2t10'],//            $f2t19 = $_POST['f2t19'],//            $f2t11 = $_POST['f2t11'],//            $f2t12 = $_POST['f2t12'],//            $f2t13 = $_POST['f2t13'],//            $f2t14 = $_POST['f2t14'],//            //de Fort Pierce a sus respectivas areas//            $f3t4 = $_POST['f3t4'],//            $f3t5 = $_POST['f3t5'],//            $f3t6 = $_POST['f3t6'],//            $f3t7 = $_POST['f3t7'],//            $f3t8 = $_POST['f3t8'],//            $f3t9 = $_POST['f3t9'],//            $f3t10 = $_POST['f3t10'],//            $f3t19 = $_POST['f3t19'],//            $f3t11 = $_POST['f3t11'],//            $f3t12 = $_POST['f3t12'],//            $f3t13 = $_POST['f3t13'],//            $f3t14 = $_POST['f3t14'],//            //de Lake$_POSTorth a sus respectivas areas//            $f4t5 = $_POST['f4t5'],//            $f4t6 = $_POST['f4t6'],//            $f4t7 = $_POST['f4t7'],//            $f4t8 = $_POST['f4t8'],//            $f4t9 = $_POST['f4t9'],//            $f4t10 = $_POST['f4t10'],//            $f4t19 = $_POST['f4t19'],//            $f4t11 = $_POST['f4t11'],//            $f4t12 = $_POST['f4t12'],//            $f4t13 = $_POST['f4t13'],//            $f4t14 = $_POST['f4t14'],//            //FordLauderdale//            $f5t6 = $_POST['f5t6'],//            $f5t7 = $_POST['f5t7'],//            $f5t8 = $_POST['f5t8'],//            $f5t9 = $_POST['f5t9'],//            $f5t10 = $_POST['f5t10'],//            $f5t19 = $_POST['f5t19'],//            $f5t11 = $_POST['f5t11'],//            $f5t12 = $_POST['f5t12'],//            $f5t13 = $_POST['f5t13'],            //            $f5t14 = $_POST['f5t14']//       );//       echo '<pre>';//        print_r($datos);//        exit();//        echo '</pre>';            } else {                echo "...";            }//        echo '<pre>';//        print_r($datos);//        exit();//        echo '</pre>';//        $fecha_iniforma = $fecha_ini;////        $fecha_iniforma2 = $fecha_ini2;            $fecha_iniforma = $fecha_inicial;            $fecha_iniforma2 = $fecha_final;//        $fecha_inicial  = $_POST['fecha_ini1'];//        $fecha_final = $_POST['fecha_fin1'];            $fecha_inibus = strtotime($fecha_inicial);            $fecha_finbus = strtotime($fecha_final);            if ($new) {                Doo::db()->insert($trip);            } else {                //Doo::db()->update($trip);                if ($trip_nro == 100 || $trip_nro == 200) {                    $sql = "SELECT * FROM  routes WHERE fecha_ini between '$fecha_iniforma' AND '$fecha_final' AND trip_no = '$trip_nro'  AND type_rate = 0 AND trip_from = 1 AND trip_to = 3 ";                    $rs = Doo::db()->query($sql);                    $trips = $rs->fetchAll();                    $num = count($trips);                }                if ($trip_nro == 301) {                    $sql = "SELECT * FROM  routes WHERE fecha_ini between '$fecha_iniforma' AND '$fecha_final' AND trip_no = '$trip_nro'  AND type_rate = 0 AND trip_from = 3 AND trip_to = 1 ";                    $rs = Doo::db()->query($sql);                    $trips = $rs->fetchAll();                    $num = count($trips);                }                if ($trip_nro == 101 || $trip_nro == 201) {                    $sql = "SELECT * FROM  routes WHERE fecha_ini between '$fecha_iniforma' AND '$fecha_final' AND trip_no = '$trip_nro'  AND type_rate = 0 AND trip_from = 3 AND trip_to = 1 ";                    $rs = Doo::db()->query($sql);                    $trips = $rs->fetchAll();                    $num = count($trips);                }                if ($trip_nro == 300) {                    $sql = "SELECT * FROM  routes WHERE fecha_ini between '$fecha_iniforma' AND '$fecha_final' AND trip_no = '$trip_nro'  AND type_rate = 0 AND trip_from = 1 AND trip_to = 3 ";                    $rs = Doo::db()->query($sql);                    $trips = $rs->fetchAll();                    $num = count($trips);                }                //                echo '<pre>';//                echo $vehicles;//                echo $capacity2;//                echo $trip_nro;//                echo $fecha_inibus;//                echo $fecha_finbus; //                echo '</pre>';//                exit();                 if ($num == 0) {                    Doo::db()->insert($routes);                } else {                    ///////////////////////////// CREAR VEHICULOS ADICIONALES //////////////////////////////////////////////////////////////                                        if (($trip_nro == 100 || $trip_nro == 200 || $trip_nro == 300 || $trip_nro == 101 || $trip_nro == 201 || $trip_nro == 301) && $vehicles == '1') {                        Doo::db()->query("UPDATE passengers_bus AS p INNER JOIN bus AS b ON p.id_bus = b.id SET p.id_bus='0', p.driver2='' WHERE b.id_vehi='2' AND b.trip='$trip_nro'");                                                Doo::db()->query("UPDATE passengers_bus AS p INNER JOIN bus AS b ON p.id_bus = b.id SET p.id_bus='0', p.driver3='' WHERE b.id_vehi='3' AND b.trip='$trip_nro'");                                                Doo::db()->query("UPDATE passengers_bus AS p INNER JOIN bus AS b ON p.id_bus = b.id SET p.id_bus='0', p.driver4='' WHERE b.id_vehi='4' AND b.trip='$trip_nro'");                                                Doo::db()->query("UPDATE passengers_bus AS p INNER JOIN bus AS b ON p.id_bus = b.id SET p.id_bus='0', p.driver5='' WHERE b.id_vehi='5' AND b.trip='$trip_nro'");                                                                        Doo::db()->query("DELETE a1, a2 FROM  bus AS a1 INNER JOIN bus_trips AS a2 WHERE a1.id = a2.id_bus AND  a1.fecha_ini= '$fecha_inibus' AND a1.fecha_fin='$fecha_finbus' AND a1.id_vehi='2' AND a1.trip='$trip_nro'");                        Doo::db()->query("DELETE a1, a2 FROM  bus AS a1 INNER JOIN bus_trips AS a2 WHERE a1.id = a2.id_bus AND  a1.fecha_ini= '$fecha_inibus' AND a1.fecha_fin='$fecha_finbus' AND a1.id_vehi='3' AND a1.trip='$trip_nro'");                        Doo::db()->query("DELETE a1, a2 FROM  bus AS a1 INNER JOIN bus_trips AS a2 WHERE a1.id = a2.id_bus AND  a1.fecha_ini= '$fecha_inibus' AND a1.fecha_fin='$fecha_finbus' AND a1.id_vehi='4' AND a1.trip='$trip_nro'");                        Doo::db()->query("DELETE a1, a2 FROM  bus AS a1 INNER JOIN bus_trips AS a2 WHERE a1.id = a2.id_bus AND  a1.fecha_ini= '$fecha_inibus' AND a1.fecha_fin='$fecha_finbus' AND a1.id_vehi='5' AND a1.trip='$trip_nro'");                                                Doo::db()->query("UPDATE passengers_bus  SET driver2='', driver3='', driver4='', driver5='' WHERE fec_ini = '$fecha_inicial' AND trip='$trip_nro'");                        //DELETE a1, a2, a3 FROM  bus AS a1 INNER JOIN bus_trips AS a2 INNER JOIN passengers_bus AS a3 WHERE a1.id = a2.id_bus AND a2.id_bus = a3.id_bus AND  a1.fecha_ini= '1502164800' AND a1.fecha_fin='1502164800' AND a1.id_vehi='2' AND a1.trip='200';                    }                    if (($trip_nro == 100 || $trip_nro == 200 || $trip_nro == 300 || $trip_nro == 101 || $trip_nro == 201 || $trip_nro == 301) && $vehicles == '2') {                                                Doo::db()->query("UPDATE passengers_bus AS p INNER JOIN bus AS b ON p.id_bus = b.id SET p.id_bus='0', p.driver3='' WHERE b.id_vehi='3' AND b.trip='$trip_nro'");                                                Doo::db()->query("UPDATE passengers_bus AS p INNER JOIN bus AS b ON p.id_bus = b.id SET p.id_bus='0', p.driver4='' WHERE b.id_vehi='4' AND b.trip='$trip_nro'");                                                Doo::db()->query("UPDATE passengers_bus AS p INNER JOIN bus AS b ON p.id_bus = b.id SET p.id_bus='0', p.driver5='' WHERE b.id_vehi='5' AND b.trip='$trip_nro'");                                                                        Doo::db()->query("DELETE a1, a2 FROM  bus AS a1 INNER JOIN bus_trips AS a2 WHERE a1.id = a2.id_bus AND  a1.fecha_ini= '$fecha_inibus' AND a1.fecha_fin='$fecha_finbus' AND a1.id_vehi='3' AND a1.trip='$trip_nro'");                        Doo::db()->query("DELETE a1, a2 FROM  bus AS a1 INNER JOIN bus_trips AS a2 WHERE a1.id = a2.id_bus AND  a1.fecha_ini= '$fecha_inibus' AND a1.fecha_fin='$fecha_finbus' AND a1.id_vehi='4' AND a1.trip='$trip_nro'");                        Doo::db()->query("DELETE a1, a2 FROM  bus AS a1 INNER JOIN bus_trips AS a2 WHERE a1.id = a2.id_bus AND  a1.fecha_ini= '$fecha_inibus' AND a1.fecha_fin='$fecha_finbus' AND a1.id_vehi='5' AND a1.trip='$trip_nro'");                                                Doo::db()->query("UPDATE passengers_bus  SET driver3='', driver4='', driver5='' WHERE fec_ini = '$fecha_inicial' AND trip='$trip_nro'");                        $sqlcon = "SELECT SUM(id_vehi) as VEHICLE FROM bus WHERE fecha_ini= '$fecha_inibus' AND fecha_fin='$fecha_finbus' AND trip='$trip_nro'";                        $rscon = Doo::db()->query($sqlcon);                        $consul = $rscon->fetchAll();                        foreach ($consul as $rel) {                                                    }                        $idvehi = $rel['VEHICLE'];                        if ($idvehi == 2) {                                                    } else {                            Doo::db()->query("INSERT INTO bus(id,plate,tipobus,capacidad,fecha_ini,fecha_fin,id_vehi,trip) VALUES('','VEHICLE #2 TRIP $trip_nro','BUS','$capacity2','$fecha_inibus','$fecha_finbus','2','$trip_nro');");                            $sqlbus = "SELECT id FROM bus WHERE fecha_ini= '$fecha_inibus' AND fecha_fin='$fecha_finbus' AND trip='$trip_nro' ORDER BY id DESC LIMIT 1";                            $rsbus = Doo::db()->query($sqlbus);                            $idbus = $rsbus->fetchAll();                            foreach ($idbus as $trbus) {                                                            }                            $idbus_trips = $trbus['id'];                                                       Doo::db()->query("INSERT INTO bus_trips(id_bus,id_trips) VALUES('$idbus_trips','$id_trips');");                                                                                    }                    }                    if (($trip_nro == 100 || $trip_nro == 200 || $trip_nro == 300 || $trip_nro == 101 || $trip_nro == 201 || $trip_nro == 301) && $vehicles == '3') {                        Doo::db()->query("UPDATE passengers_bus AS p INNER JOIN bus AS b ON p.id_bus = b.id SET p.id_bus='0', p.driver4='' WHERE b.id_vehi='4' AND b.trip='$trip_nro'");                                                Doo::db()->query("UPDATE passengers_bus AS p INNER JOIN bus AS b ON p.id_bus = b.id SET p.id_bus='0', p.driver5='' WHERE b.id_vehi='5' AND b.trip='$trip_nro'");                                                Doo::db()->query("DELETE a1, a2 FROM  bus AS a1 INNER JOIN bus_trips AS a2 WHERE a1.id = a2.id_bus AND  a1.fecha_ini= '$fecha_inibus' AND a1.fecha_fin='$fecha_finbus' AND a1.id_vehi='4' AND a1.trip='$trip_nro'");                        Doo::db()->query("DELETE a1, a2 FROM  bus AS a1 INNER JOIN bus_trips AS a2 WHERE a1.id = a2.id_bus AND  a1.fecha_ini= '$fecha_inibus' AND a1.fecha_fin='$fecha_finbus' AND a1.id_vehi='5' AND a1.trip='$trip_nro'");                        Doo::db()->query("UPDATE passengers_bus  SET driver4='', driver5='' WHERE fec_ini = '$fecha_inicial' AND trip='$trip_nro'");                        $sqlcon = "SELECT SUM(id_vehi) as VEHICLE FROM bus WHERE fecha_ini= '$fecha_inibus' AND fecha_fin='$fecha_finbus' AND trip='$trip_nro'";                        $rscon = Doo::db()->query($sqlcon);                        $consul = $rscon->fetchAll();                        foreach ($consul as $rel) {                                                    }                        $idvehi = $rel['VEHICLE'];                        if ($idvehi == 2) {                            Doo::db()->query("INSERT INTO bus(id,plate,tipobus,capacidad,fecha_ini,fecha_fin,id_vehi,trip) VALUES('','VEHICLE #3 TRIP $trip_nro','BUS','$capacity3','$fecha_inibus','$fecha_finbus','3','$trip_nro');");                            $sqlbus3 = "SELECT id FROM bus WHERE fecha_ini= '$fecha_inibus' AND fecha_fin='$fecha_finbus' AND trip='$trip_nro' ORDER BY id DESC LIMIT 1";                            $rsbus3 = Doo::db()->query($sqlbus3);                            $idbus3 = $rsbus3->fetchAll();                            foreach ($idbus3 as $trbus3) {                                                            }                            $idbus_trips3 = $trbus3['id'];                            Doo::db()->query("INSERT INTO bus_trips(id_bus,id_trips) VALUES('$idbus_trips3','$id_trips');");                                                    } else {                            Doo::db()->query("INSERT INTO bus(id,plate,tipobus,capacidad,fecha_ini,fecha_fin,id_vehi,trip) VALUES('','VEHICLE #2 TRIP $trip_nro','BUS','$capacity2','$fecha_inibus','$fecha_finbus','2','$trip_nro');");                            $sqlbus = "SELECT id FROM bus WHERE fecha_ini= '$fecha_inibus' AND fecha_fin='$fecha_finbus' AND trip='$trip_nro' ORDER BY id DESC LIMIT 1";                            $rsbus = Doo::db()->query($sqlbus);                            $idbus = $rsbus->fetchAll();                            foreach ($idbus as $trbus) {                                                            }                            $idbus_trips = $trbus['id'];                            Doo::db()->query("INSERT INTO bus_trips(id_bus,id_trips) VALUES('$idbus_trips','$id_trips');");                            Doo::db()->query("INSERT INTO bus(id,plate,tipobus,capacidad,fecha_ini,fecha_fin,id_vehi,trip) VALUES('','VEHICLE #3 TRIP $trip_nro','BUS','$capacity3','$fecha_inibus','$fecha_finbus','3','$trip_nro');");                            $sqlbus3 = "SELECT id FROM bus WHERE fecha_ini= '$fecha_inibus' AND fecha_fin='$fecha_finbus' AND trip='$trip_nro' ORDER BY id DESC LIMIT 1";                            $rsbus3 = Doo::db()->query($sqlbus3);                            $idbus3 = $rsbus3->fetchAll();                            foreach ($idbus3 as $trbus3) {                                                            }                            $idbus_trips3 = $trbus3['id'];                            Doo::db()->query("INSERT INTO bus_trips(id_bus,id_trips) VALUES('$idbus_trips3','$id_trips');");                        }                    }                    //////////////////////////////////////////////////////////////////                    if (($trip_nro == 100 || $trip_nro == 200 || $trip_nro == 300 || $trip_nro == 101 || $trip_nro == 201 || $trip_nro == 301) && $vehicles == '4') {                        Doo::db()->query("UPDATE passengers_bus AS p INNER JOIN bus AS b ON p.id_bus = b.id SET p.id_bus='0', p.driver5='' WHERE b.id_vehi='5' AND b.trip='$trip_nro'");                                                 Doo::db()->query("DELETE a1, a2 FROM  bus AS a1 INNER JOIN bus_trips AS a2 WHERE a1.id = a2.id_bus AND  a1.fecha_ini= '$fecha_inibus' AND a1.fecha_fin='$fecha_finbus' AND a1.id_vehi='5' AND a1.trip='$trip_nro'");                        Doo::db()->query("UPDATE passengers_bus  SET driver5='' WHERE fec_ini = '$fecha_inicial' AND trip='$trip_nro'");                        $sqlcon = "SELECT SUM(id_vehi) as VEHICLE FROM bus WHERE fecha_ini= '$fecha_inibus' AND fecha_fin='$fecha_finbus' AND trip='$trip_nro'";                        $rscon = Doo::db()->query($sqlcon);                        $consul = $rscon->fetchAll();                        foreach ($consul as $rel) {                                                    }                        $idvehi = $rel['VEHICLE'];                        if ($idvehi == 2) {                            Doo::db()->query("INSERT INTO bus(id,plate,tipobus,capacidad,fecha_ini,fecha_fin,id_vehi,trip) VALUES('','VEHICLE #3 TRIP $trip_nro','BUS','$capacity3','$fecha_inibus','$fecha_finbus','3','$trip_nro');");                            $sqlbus3 = "SELECT id FROM bus WHERE fecha_ini= '$fecha_inibus' AND fecha_fin='$fecha_finbus' AND trip='$trip_nro' ORDER BY id DESC LIMIT 1";                            $rsbus3 = Doo::db()->query($sqlbus3);                            $idbus3 = $rsbus3->fetchAll();                            foreach ($idbus3 as $trbus3) {                                                            }                            $idbus_trips3 = $trbus3['id'];                            Doo::db()->query("INSERT INTO bus_trips(id_bus,id_trips) VALUES('$idbus_trips3','$id_trips');");                            Doo::db()->query("INSERT INTO bus(id,plate,tipobus,capacidad,fecha_ini,fecha_fin,id_vehi,trip) VALUES('','VEHICLE #4 TRIP $trip_nro','BUS','$capacity4','$fecha_inibus','$fecha_finbus','4','$trip_nro');");                            $sqlbus4 = "SELECT id FROM bus WHERE fecha_ini= '$fecha_inibus' AND fecha_fin='$fecha_finbus' AND trip='$trip_nro' ORDER BY id DESC LIMIT 1";                            $rsbus4 = Doo::db()->query($sqlbus4);                            $idbus4 = $rsbus4->fetchAll();                            foreach ($idbus4 as $trbus4) {                                                            }                            $idbus_trips4 = $trbus4['id'];                            Doo::db()->query("INSERT INTO bus_trips(id_bus,id_trips) VALUES('$idbus_trips4','$id_trips');");                        } else if ($idvehi == 5) {                            Doo::db()->query("INSERT INTO bus(id,plate,tipobus,capacidad,fecha_ini,fecha_fin,id_vehi,trip) VALUES('','VEHICLE #4 TRIP $trip_nro','BUS','$capacity4','$fecha_inibus','$fecha_finbus','4','$trip_nro');");                            $sqlbus4 = "SELECT id FROM bus WHERE fecha_ini= '$fecha_inibus' AND fecha_fin='$fecha_finbus' AND trip='$trip_nro' ORDER BY id DESC LIMIT 1";                            $rsbus4 = Doo::db()->query($sqlbus4);                            $idbus4 = $rsbus4->fetchAll();                            foreach ($idbus4 as $trbus4) {                                                            }                            $idbus_trips4 = $trbus4['id'];                            Doo::db()->query("INSERT INTO bus_trips(id_bus,id_trips) VALUES('$idbus_trips4','$id_trips');");                                                    } else {                            Doo::db()->query("INSERT INTO bus(id,plate,tipobus,capacidad,fecha_ini,fecha_fin,id_vehi,trip) VALUES('','VEHICLE #2 TRIP $trip_nro','BUS','$capacity2','$fecha_inibus','$fecha_finbus','2','$trip_nro');");                            $sqlbus = "SELECT id FROM bus WHERE fecha_ini= '$fecha_inibus' AND fecha_fin='$fecha_finbus' AND trip='$trip_nro' ORDER BY id DESC LIMIT 1";                            $rsbus = Doo::db()->query($sqlbus);                            $idbus = $rsbus->fetchAll();                            foreach ($idbus as $trbus) {                                                            }                            $idbus_trips = $trbus['id'];                            Doo::db()->query("INSERT INTO bus_trips(id_bus,id_trips) VALUES('$idbus_trips','$id_trips');");                            Doo::db()->query("INSERT INTO bus(id,plate,tipobus,capacidad,fecha_ini,fecha_fin,id_vehi,trip) VALUES('','VEHICLE #3 TRIP $trip_nro','BUS','$capacity3','$fecha_inibus','$fecha_finbus','3','$trip_nro');");                            $sqlbus3 = "SELECT id FROM bus WHERE fecha_ini= '$fecha_inibus' AND fecha_fin='$fecha_finbus' AND trip='$trip_nro' ORDER BY id DESC LIMIT 1";                            $rsbus3 = Doo::db()->query($sqlbus3);                            $idbus3 = $rsbus3->fetchAll();                            foreach ($idbus3 as $trbus3) {                                                            }                            $idbus_trips3 = $trbus3['id'];                            Doo::db()->query("INSERT INTO bus_trips(id_bus,id_trips) VALUES('$idbus_trips3','$id_trips');");                            Doo::db()->query("INSERT INTO bus(id,plate,tipobus,capacidad,fecha_ini,fecha_fin,id_vehi,trip) VALUES('','VEHICLE #4 TRIP $trip_nro','BUS','$capacity4','$fecha_inibus','$fecha_finbus','4','$trip_nro');");                            $sqlbus4 = "SELECT id FROM bus WHERE fecha_ini= '$fecha_inibus' AND fecha_fin='$fecha_finbus' AND trip='$trip_nro' ORDER BY id DESC LIMIT 1";                            $rsbus4 = Doo::db()->query($sqlbus4);                            $idbus4 = $rsbus4->fetchAll();                            foreach ($idbus4 as $trbus4) {                                                            }                            $idbus_trips4 = $trbus4['id'];                            Doo::db()->query("INSERT INTO bus_trips(id_bus,id_trips) VALUES('$idbus_trips4','$id_trips');");                        }                    }                    //////////////////////////////////////////////////////////////////                    if (($trip_nro == 100 || $trip_nro == 200 || $trip_nro == 300 || $trip_nro == 101 || $trip_nro == 201 || $trip_nro == 301) && $vehicles == '5') {                        $sqlcon = "SELECT SUM(id_vehi) as VEHICLE FROM bus WHERE fecha_ini= '$fecha_inibus' AND fecha_fin='$fecha_finbus' AND trip='$trip_nro'";                        $rscon = Doo::db()->query($sqlcon);                        $consul = $rscon->fetchAll();                        foreach ($consul as $rel) {                                                    }                        $idvehi = $rel['VEHICLE'];                        if ($idvehi == 2) {                            Doo::db()->query("INSERT INTO bus(id,plate,tipobus,capacidad,fecha_ini,fecha_fin,id_vehi,trip) VALUES('','VEHICLE #3 TRIP $trip_nro','BUS','$capacity3','$fecha_inibus','$fecha_finbus','3','$trip_nro');");                            $sqlbus3 = "SELECT id FROM bus WHERE fecha_ini= '$fecha_inibus' AND fecha_fin='$fecha_finbus' AND trip='$trip_nro' ORDER BY id DESC LIMIT 1";                            $rsbus3 = Doo::db()->query($sqlbus3);                            $idbus3 = $rsbus3->fetchAll();                            foreach ($idbus3 as $trbus3) {                                                            }                            $idbus_trips3 = $trbus3['id'];                            Doo::db()->query("INSERT INTO bus_trips(id_bus,id_trips) VALUES('$idbus_trips3','$id_trips');");                            Doo::db()->query("INSERT INTO bus(id,plate,tipobus,capacidad,fecha_ini,fecha_fin,id_vehi,trip) VALUES('','VEHICLE #4 TRIP $trip_nro','BUS','$capacity4','$fecha_inibus','$fecha_finbus','4','$trip_nro');");                            $sqlbus4 = "SELECT id FROM bus WHERE fecha_ini= '$fecha_inibus' AND fecha_fin='$fecha_finbus' AND trip='$trip_nro' ORDER BY id DESC LIMIT 1";                            $rsbus4 = Doo::db()->query($sqlbus4);                            $idbus4 = $rsbus4->fetchAll();                            foreach ($idbus4 as $trbus4) {                                                            }                            $idbus_trips4 = $trbus4['id'];                            Doo::db()->query("INSERT INTO bus_trips(id_bus,id_trips) VALUES('$idbus_trips4','$id_trips');");                            Doo::db()->query("INSERT INTO bus(id,plate,tipobus,capacidad,fecha_ini,fecha_fin,id_vehi,trip) VALUES('','VEHICLE #5 TRIP $trip_nro','BUS','$capacity5','$fecha_inibus','$fecha_finbus','5','$trip_nro');");                            $sqlbus5 = "SELECT id FROM bus WHERE fecha_ini= '$fecha_inibus' AND fecha_fin='$fecha_finbus' AND trip='$trip_nro' ORDER BY id DESC LIMIT 1";                            $rsbus5 = Doo::db()->query($sqlbus5);                            $idbus5 = $rsbus5->fetchAll();                            foreach ($idbus5 as $trbus5) {                                                            }                            $idbus_trips5 = $trbus5['id'];                            Doo::db()->query("INSERT INTO bus_trips(id_bus,id_trips) VALUES('$idbus_trips5','$id_trips');");                        } else if ($idvehi == 5) {                            Doo::db()->query("INSERT INTO bus(id,plate,tipobus,capacidad,fecha_ini,fecha_fin,id_vehi,trip) VALUES('','VEHICLE #4 TRIP $trip_nro','BUS','$capacity4','$fecha_inibus','$fecha_finbus','4','$trip_nro');");                            $sqlbus4 = "SELECT id FROM bus WHERE fecha_ini= '$fecha_inibus' AND fecha_fin='$fecha_finbus' AND trip='$trip_nro' ORDER BY id DESC LIMIT 1";                            $rsbus4 = Doo::db()->query($sqlbus4);                            $idbus4 = $rsbus4->fetchAll();                            foreach ($idbus4 as $trbus4) {                                                            }                            $idbus_trips4 = $trbus4['id'];                            Doo::db()->query("INSERT INTO bus_trips(id_bus,id_trips) VALUES('$idbus_trips4','$id_trips');");                            Doo::db()->query("INSERT INTO bus(id,plate,tipobus,capacidad,fecha_ini,fecha_fin,id_vehi,trip) VALUES('','VEHICLE #5 TRIP $trip_nro','BUS','$capacity5','$fecha_inibus','$fecha_finbus','5','$trip_nro');");                            $sqlbus5 = "SELECT id FROM bus WHERE fecha_ini= '$fecha_inibus' AND fecha_fin='$fecha_finbus' AND trip='$trip_nro' ORDER BY id DESC LIMIT 1";                            $rsbus5 = Doo::db()->query($sqlbus5);                            $idbus5 = $rsbus5->fetchAll();                            foreach ($idbus5 as $trbus5) {                                                            }                            $idbus_trips5 = $trbus5['id'];                            Doo::db()->query("INSERT INTO bus_trips(id_bus,id_trips) VALUES('$idbus_trips5','$id_trips');");                                                    } else if ($idvehi == 9) {                            Doo::db()->query("INSERT INTO bus(id,plate,tipobus,capacidad,fecha_ini,fecha_fin,id_vehi,trip) VALUES('','VEHICLE #5 TRIP $trip_nro','BUS','$capacity5','$fecha_inibus','$fecha_finbus','5','$trip_nro');");                            $sqlbus5 = "SELECT id FROM bus WHERE fecha_ini= '$fecha_inibus' AND fecha_fin='$fecha_finbus' AND trip='$trip_nro' ORDER BY id DESC LIMIT 1";                            $rsbus5 = Doo::db()->query($sqlbus5);                            $idbus5 = $rsbus5->fetchAll();                            foreach ($idbus5 as $trbus5) {                                                            }                            $idbus_trips5 = $trbus5['id'];                            Doo::db()->query("INSERT INTO bus_trips(id_bus,id_trips) VALUES('$idbus_trips5','$id_trips');");                                                    } else {                            Doo::db()->query("INSERT INTO bus(id,plate,tipobus,capacidad,fecha_ini,fecha_fin,id_vehi,trip) VALUES('','VEHICLE #2 TRIP $trip_nro','BUS','$capacity2','$fecha_inibus','$fecha_finbus','2','$trip_nro');");                            $sqlbus = "SELECT id FROM bus WHERE fecha_ini= '$fecha_inibus' AND fecha_fin='$fecha_finbus' AND trip='$trip_nro' ORDER BY id DESC LIMIT 1";                            $rsbus = Doo::db()->query($sqlbus);                            $idbus = $rsbus->fetchAll();                            foreach ($idbus as $trbus) {                                                            }                            $idbus_trips = $trbus['id'];                            Doo::db()->query("INSERT INTO bus_trips(id_bus,id_trips) VALUES('$idbus_trips','$id_trips');");                            Doo::db()->query("INSERT INTO bus(id,plate,tipobus,capacidad,fecha_ini,fecha_fin,id_vehi,trip) VALUES('','VEHICLE #3 TRIP $trip_nro','BUS','$capacity3','$fecha_inibus','$fecha_finbus','3','$trip_nro');");                            $sqlbus3 = "SELECT id FROM bus WHERE fecha_ini= '$fecha_inibus' AND fecha_fin='$fecha_finbus' AND trip='$trip_nro' ORDER BY id DESC LIMIT 1";                            $rsbus3 = Doo::db()->query($sqlbus3);                            $idbus3 = $rsbus3->fetchAll();                            foreach ($idbus3 as $trbus3) {                                                            }                            $idbus_trips3 = $trbus3['id'];                            Doo::db()->query("INSERT INTO bus_trips(id_bus,id_trips) VALUES('$idbus_trips3','$id_trips');");                            Doo::db()->query("INSERT INTO bus(id,plate,tipobus,capacidad,fecha_ini,fecha_fin,id_vehi,trip) VALUES('','VEHICLE #4 TRIP $trip_nro','BUS','$capacity4','$fecha_inibus','$fecha_finbus','4','$trip_nro');");                            $sqlbus4 = "SELECT id FROM bus WHERE fecha_ini= '$fecha_inibus' AND fecha_fin='$fecha_finbus' AND trip='$trip_nro' ORDER BY id DESC LIMIT 1";                            $rsbus4 = Doo::db()->query($sqlbus4);                            $idbus4 = $rsbus4->fetchAll();                            foreach ($idbus4 as $trbus4) {                                                            }                            $idbus_trips4 = $trbus4['id'];                            Doo::db()->query("INSERT INTO bus_trips(id_bus,id_trips) VALUES('$idbus_trips4','$id_trips');");                            Doo::db()->query("INSERT INTO bus(id,plate,tipobus,capacidad,fecha_ini,fecha_fin,id_vehi,trip) VALUES('','VEHICLE #5 TRIP $trip_nro','BUS','$capacity5','$fecha_inibus','$fecha_finbus','5','$trip_nro');");                            $sqlbus5 = "SELECT id FROM bus WHERE fecha_ini= '$fecha_inibus' AND fecha_fin='$fecha_finbus' AND trip='$trip_nro' ORDER BY id DESC LIMIT 1";                            $rsbus5 = Doo::db()->query($sqlbus5);                            $idbus5 = $rsbus5->fetchAll();                            foreach ($idbus5 as $trbus5) {                                                            }                            $idbus_trips5 = $trbus5['id'];                            Doo::db()->query("INSERT INTO bus_trips(id_bus,id_trips) VALUES('$idbus_trips5','$id_trips');");                        }                    }                    if ($trip_nro == 100 || $trip_nro == 200) {                        //dia 1                        //de Orlando a las demas areas                        if ($d1 == 1) {                                                        Doo::db()->query("UPDATE routes SET  vehicles='$vehicles', capacity='$capacity', capacity2='$capacity2', capacity3='$capacity3', capacity4='$capacity4', capacity5='$capacity5', seats_remain='$seats_remain', spprc_adult='$spprc_adult', spprc_child ='$spprc_child', sdprc_adult='$sdprc_adult', sdprc_child = '$sdprc_child', wfprc_adult = '$wfprc_adult', wfprc_child = '$wfprc_child', stprc_adult = '$stprc_adult', stprc_child = '$stprc_child', sflexprc_adult = '$sflexprc_adult', sflexprc_child = '$sflexprc_child', flresprc_adult = '$flresprc_adult', flresprc_child = '$flresprc_child', spseats = '$spseats', sdseats ='$sdseats', wfseats='$wfseats', stseats='$stseats', sflexseats='$sflexseats', spprcseats='$spprcseats', toursseats='$toursseats', univext='$univext', wdext='$wdext', f1t3='$f1t3', f1t4='$f1t4', f1t5='$f1t5', f1t6='$f1t6', f1t7='$f1t7', f1t8='$f1t8', f1t9='$f1t9', f1t10='$f1t10', f1t19='$f1t19', f1t11='$f1t12', f1t12='$f1t11', f1t13='$f1t13', f1t14='$f1t14', f2t3='$f2t3', f2t4='$f2t4', f2t5='$f2t5', f2t6='$f2t6', f2t7='$f2t7', f2t8='$f2t8', f2t9='$f2t9', f2t10='$f2t10', f2t19='$f2t19', f2t11='$f2t12', f2t12='$f2t11', f2t13='$f2t13', f2t14='$f2t14', f3t4='$f3t4', f3t5='$f3t5', f3t6='$f3t6', f3t7='$f3t7', f3t8='$f3t8', f3t9='$f3t9', f3t10='$f3t10', f3t19='$f3t19', f3t11='$f3t12', f3t12='$f3t11', f3t13='$f3t13', f3t14='$f3t14', f4t5='$f4t5', f4t6='$f4t6', f4t7='$f4t7', f4t8='$f4t8', f4t9='$f4t9', f4t10='$f4t10', f4t19='$f4t19', f4t11='$f4t12', f4t12='$f4t11', f4t13='$f4t13', f4t14='$f4t14', f5t6='$f5t6', f5t7='$f5t7', f5t8='$f5t8', f5t9='$f5t9', f5t10='$f5t10', f5t19='$f5t19', f5t11='$f5t12', f5t12='$f5t11', f5t13='$f5t13', f5t14='$f5t14'  WHERE fecha_ini >='$fecha_iniforma' AND fecha_fin <= '$fecha_iniforma2' AND trip_no = '$trip_nro' AND type_rate = '0'");                        }                    }                    if ($trip_nro == 300) {                        //dia 1                        //de Orlando a las demas areas                        if ($d1 == 1) {                                                         Doo::db()->query("UPDATE routes SET  vehicles='$vehicles', capacity='$capacity', capacity2='$capacity2', capacity3='$capacity3', capacity4='$capacity4', capacity5='$capacity5', seats_remain='$seats_remain', spprc_adult='$spprc_adult', spprc_child ='$spprc_child', sdprc_adult='$sdprc_adult', sdprc_child = '$sdprc_child', wfprc_adult = '$wfprc_adult', wfprc_child = '$wfprc_child', stprc_adult = '$stprc_adult', stprc_child = '$stprc_child', sflexprc_adult = '$sflexprc_adult', sflexprc_child = '$sflexprc_child', flresprc_adult = '$flresprc_adult', flresprc_child = '$flresprc_child', spseats = '$spseats', sdseats ='$sdseats', wfseats='$wfseats', stseats='$stseats', sflexseats='$sflexseats', spprcseats='$spprcseats', toursseats='$toursseats', univext='$univext', wdext='$wdext', f1t3='$f1t3', f1t4='$f1t4', f1t5='$f1t5', f1t6='$f1t6', f1t7='$f1t7', f1t8='$f1t8', f1t9='$f1t9', f1t10='$f1t10', f1t19='$f1t19', f1t11='$f1t12', f1t12='$f1t11', f1t13='$f1t13', f1t14='$f1t14', f2t3='$f2t3', f2t4='$f2t4', f2t5='$f2t5', f2t6='$f2t6', f2t7='$f2t7', f2t8='$f2t8', f2t9='$f2t9', f2t10='$f2t10', f2t19='$f2t19', f2t11='$f2t12', f2t12='$f2t11', f2t13='$f2t13', f2t14='$f2t14', f3t4='$f3t4', f3t5='$f3t5', f3t6='$f3t6', f3t7='$f3t7', f3t8='$f3t8', f3t9='$f3t9', f3t10='$f3t10', f3t19='$f3t19', f3t11='$f3t12', f3t12='$f3t11', f3t13='$f3t13', f3t14='$f3t14', f4t5='$f4t5', f4t6='$f4t6', f4t7='$f4t7', f4t8='$f4t8', f4t9='$f4t9', f4t10='$f4t10', f4t19='$f4t19', f4t11='$f4t12', f4t12='$f4t11', f4t13='$f4t13', f4t14='$f4t14', f5t6='$f5t6', f5t7='$f5t7', f5t8='$f5t8', f5t9='$f5t9', f5t10='$f5t10', f5t19='$f5t19', f5t11='$f5t12', f5t12='$f5t11', f5t13='$f5t13', f5t14='$f5t14'  WHERE fecha_ini >='$fecha_iniforma' AND fecha_fin <= '$fecha_iniforma2' AND trip_no = '$trip_nro' AND type_rate = '0'");                                                                                }                    }                    //301                                                    if ($trip_nro == 301) {                        //dia 1                        //de Orlando a las demas areas                        if ($d1 == 1) {                                                         Doo::db()->query("UPDATE routes SET  vehicles='$vehicles', capacity='$capacity', capacity2='$capacity2', capacity3='$capacity3', capacity4='$capacity4', capacity5='$capacity5', seats_remain='$seats_remain', spprc_adult='$spprc_adult', spprc_child ='$spprc_child', sdprc_adult='$sdprc_adult', sdprc_child = '$sdprc_child', wfprc_adult = '$wfprc_adult', wfprc_child = '$wfprc_child', stprc_adult = '$stprc_adult', stprc_child = '$stprc_child', sflexprc_adult = '$sflexprc_adult', sflexprc_child = '$sflexprc_child', flresprc_adult = '$flresprc_adult', flresprc_child = '$flresprc_child', spseats = '$spseats', sdseats ='$sdseats', wfseats='$wfseats', stseats='$stseats', sflexseats='$sflexseats', spprcseats='$spprcseats', toursseats='$toursseats', univext='$univext', wdext='$wdext', f1t3='$f1t3', f1t4='$f1t4', f1t5='$f1t5', f1t6='$f1t6', f1t7='$f1t7', f1t8='$f1t8', f1t9='$f1t9', f1t10='$f1t10', f1t19='$f1t19', f1t11='$f1t12', f1t12='$f1t11', f1t13='$f1t13', f1t14='$f1t14', f2t3='$f2t3', f2t4='$f2t4', f2t5='$f2t5', f2t6='$f2t6', f2t7='$f2t7', f2t8='$f2t8', f2t9='$f2t9', f2t10='$f2t10', f2t19='$f2t19', f2t11='$f2t12', f2t12='$f2t11', f2t13='$f2t13', f2t14='$f2t14', f3t4='$f3t4', f3t5='$f3t5', f3t6='$f3t6', f3t7='$f3t7', f3t8='$f3t8', f3t9='$f3t9', f3t10='$f3t10', f3t19='$f3t19', f3t11='$f3t12', f3t12='$f3t11', f3t13='$f3t13', f3t14='$f3t14', f4t5='$f4t5', f4t6='$f4t6', f4t7='$f4t7', f4t8='$f4t8', f4t9='$f4t9', f4t10='$f4t10', f4t19='$f4t19', f4t11='$f4t12', f4t12='$f4t11', f4t13='$f4t13', f4t14='$f4t14', f5t6='$f5t6', f5t7='$f5t7', f5t8='$f5t8', f5t9='$f5t9', f5t10='$f5t10', f5t19='$f5t19', f5t11='$f5t12', f5t12='$f5t11', f5t13='$f5t13', f5t14='$f5t14'  WHERE fecha_ini >='$fecha_iniforma' AND fecha_fin <= '$fecha_iniforma2' AND trip_no = '$trip_nro' AND type_rate = '0'");                                                    }                    }                    if ($trip_nro == 101 || $trip_nro == 201) {                        //dia 1                        //de Orlando a las demas areas                        if ($d1 == 1) {                                                         Doo::db()->query("UPDATE routes SET  vehicles='$vehicles', capacity='$capacity', capacity2='$capacity2', capacity3='$capacity3', capacity4='$capacity4', capacity5='$capacity5', seats_remain='$seats_remain', spprc_adult='$spprc_adult', spprc_child ='$spprc_child', sdprc_adult='$sdprc_adult', sdprc_child = '$sdprc_child', wfprc_adult = '$wfprc_adult', wfprc_child = '$wfprc_child', stprc_adult = '$stprc_adult', stprc_child = '$stprc_child', sflexprc_adult = '$sflexprc_adult', sflexprc_child = '$sflexprc_child', flresprc_adult = '$flresprc_adult', flresprc_child = '$flresprc_child', spseats = '$spseats', sdseats ='$sdseats', wfseats='$wfseats', stseats='$stseats', sflexseats='$sflexseats', spprcseats='$spprcseats', toursseats='$toursseats', univext='$univext', wdext='$wdext', f1t3='$f1t3', f1t4='$f1t4', f1t5='$f1t5', f1t6='$f1t6', f1t7='$f1t7', f1t8='$f1t8', f1t9='$f1t9', f1t10='$f1t10', f1t19='$f1t19', f1t11='$f1t12', f1t12='$f1t11', f1t13='$f1t13', f1t14='$f1t14', f2t3='$f2t3', f2t4='$f2t4', f2t5='$f2t5', f2t6='$f2t6', f2t7='$f2t7', f2t8='$f2t8', f2t9='$f2t9', f2t10='$f2t10', f2t19='$f2t19', f2t11='$f2t12', f2t12='$f2t11', f2t13='$f2t13', f2t14='$f2t14', f3t4='$f3t4', f3t5='$f3t5', f3t6='$f3t6', f3t7='$f3t7', f3t8='$f3t8', f3t9='$f3t9', f3t10='$f3t10', f3t19='$f3t19', f3t11='$f3t12', f3t12='$f3t11', f3t13='$f3t13', f3t14='$f3t14', f4t5='$f4t5', f4t6='$f4t6', f4t7='$f4t7', f4t8='$f4t8', f4t9='$f4t9', f4t10='$f4t10', f4t19='$f4t19', f4t11='$f4t12', f4t12='$f4t11', f4t13='$f4t13', f4t14='$f4t14', f5t6='$f5t6', f5t7='$f5t7', f5t8='$f5t8', f5t9='$f5t9', f5t10='$f5t10', f5t19='$f5t19', f5t11='$f5t12', f5t12='$f5t11', f5t13='$f5t13', f5t14='$f5t14'  WHERE fecha_ini >='$fecha_iniforma' AND fecha_fin <= '$fecha_iniforma2' AND trip_no = '$trip_nro' AND type_rate = '0'");                                                    }                    }                    //actualiza solo el segundo registro//                Doo::db()->query("UPDATE routes SET stprc_adult = '$stprc_adult2', stprc_child = '$stprc_child2' WHERE fecha_ini ='$fecha_iniforma2' AND trip_no = '$trip_no' AND type_rate = '0' AND trip_from = '1' AND trip_to = '3'");//                }                    $type_rate = $_POST['type_rate'];                    //echo '>>'.$type_rate;                    return Doo::conf()->APP_URL . "admin/routes/" . $type_rate;                }            }        }    }//    public function puesto(){//        //        ////        $fecha_ini = $this->params['fecha_ini'];////        $fecha_fin = $this->params['fecha_fin'];////        $trip_no = $this->params['trip_no'];////        ////        print($fecha_ini);////        ////        $trip_no = 300;//$this->data['item'];//        $fecha_ini1 = '2017-12-22';//        $fecha_fin1 = '2017-12-22';//        //        $sqlcap= "SELECT DISTINCT capacity, capacity2, capacity3, capacity4, capacity5 FROM routes WHERE fecha_ini = '2017-12-22' AND fecha_fin = '2017-12-22'  AND trip_no = '300' ";//        $rscap = Doo::db()->query($sqlcap);//        $capac = $rscap->fetchAll();//////        foreach ($capac as $cap) {////        }////        $capacidad1 = $cap['capacity'];//        $capacidad2 = $cap['capacity2'];//        $capacidad3 = $cap['capacity3'];//        $capacidad4 = $cap['capacity4'];//        $capacidad5 = $cap['capacity5'];////        $capacidad = $capacidad1 + $capacidad2 + $capacidad3 + $capacidad4 + $capacidad5;////        //        $sql_stdida = "SELECT (sum(pax) + sum(pax2))as tari_std//                        FROM  reservas //                        Where trip_no = '$trip_no' AND fecha_salida = '$fecha_ini1' AND id1 = '1' AND estado != 'QUOTE' AND estado != 'CANCELED' AND estado != 'NOT SHOW W/ CHARGE' AND estado != 'NOT SHOW W/O CHARGE'";//        $rs_stdida = Doo::db()->query($sql_stdida, array($trip_no, $fecha_ini1));//        $r_stdida = $rs_stdida->fetchAll();//        $std_seats_ida = $r_stdida[0]['tari_std'] ? $r_stdida[0]['tari_std'] : 0;////////        $sql_stdretorno = "SELECT (sum(pax) + sum(pax2))as tari_std//                                FROM  reservas //                                Where trip_no2 = '$trip_no' AND fecha_retorno = '$fecha_fin1' AND id2 = '1' AND estado != 'QUOTE' AND estado != 'CANCELED' AND estado != 'NOT SHOW W/ CHARGE' AND estado != 'NOT SHOW W/O CHARGE'";//        $rs_stdretorno = Doo::db()->query($sql_stdretorno, array($trip_no, $fecha_fin1));//        $r_stdretorno = $rs_stdretorno->fetchAll();//        $std_seats_retorno = $r_stdretorno[0]['tari_std'] ? $r_stdretorno[0]['tari_std'] : 0;////        $standard_total = $std_seats_ida + $std_seats_retorno;//        //        //        //        $sqlflexida = "SELECT (sum(pax) + sum(pax2))as tari_flex//                        FROM  reservas //                        Where trip_no = '$trip_no' AND fecha_salida = '$fecha_ini1' AND id1 = '2' AND estado != 'QUOTE' AND estado != 'CANCELED' AND estado != 'NOT SHOW W/ CHARGE' AND estado != 'NOT SHOW W/O CHARGE'";//        $rsflexida = Doo::db()->query($sqlflexida, array($trip_no, $fecha_ini1));//        $r_flexida = $rsflexida->fetchAll();//        $superflex_seats_ida = $r_flexida[0]['tari_flex'] ? $r_flexida[0]['tari_flex'] : 0;////        $sqlflexretorno = "SELECT (sum(pax) + sum(pax2))as tari_flex//                                FROM  reservas //                                Where trip_no2 = '$trip_no' AND fecha_retorno = '$fecha_fin1' AND id2 = '2' AND estado != 'QUOTE' AND estado != 'CANCELED' AND estado != 'NOT SHOW W/ CHARGE' AND estado != 'NOT SHOW W/O CHARGE'";//        $rsflexretorno = Doo::db()->query($sqlflexretorno, array($trip_no, $fecha_fin1));//        $r_flexretorno = $rsflexretorno->fetchAll();//        $superflex_seats_retorno = $r_flexretorno[0]['tari_flex'] ? $r_flexretorno[0]['tari_flex'] : 0;////        $superflex_total = $superflex_seats_ida + $superflex_seats_retorno;////        //TOURS////////////////////////////////////////////////////////////////////////        //De Ida//        $sqlTourIda = "SELECT (sum(pax) + sum(pax2))as ocupadas_tour//                                FROM  reservas //                                Where trip_no = '$trip_no' AND fecha_salida = '$fecha_ini1' AND (type_tour = 'ONE' OR type_tour = 'MULTI') AND estado != 'QUOTE' AND estado != 'CANCELED' AND estado != 'NOT SHOW W/ CHARGE' AND estado != 'NOT SHOW W/O CHARGE'";//        $rsti = Doo::db()->query($sqlTourIda, array($trip_no, $fecha_ini1));//        $r_tida = $rsti->fetchAll();//        $ocupadas_tour_ida = $r_tida[0]['ocupadas_tour'] ? $r_tida[0]['ocupadas_tour'] : 0;////////        //De Retorno//        $sqlTourReturn = "SELECT (sum(pax) + sum(pax2))as ocupadas_tour//                                FROM  reservas //                                Where trip_no2 = '$trip_no' AND fecha_retorno = '$fecha_fin1' AND (type_tour = 'ONE' OR type_tour = 'MULTI') AND estado != 'QUOTE' AND estado != 'CANCELED' AND estado != 'NOT SHOW W/ CHARGE' AND estado != 'NOT SHOW W/O CHARGE'";//        $rstr = Doo::db()->query($sqlTourReturn, array($trip_no, $fecha_fin1));//        $r_treturn = $rstr->fetchAll();//        $ocupadas_tour_return = $r_treturn[0]['ocupadas_tour'] ? $r_treturn[0]['ocupadas_tour'] : 0;//////        $tours_total = $ocupadas_tour_ida + $ocupadas_tour_return;////        //print($ocupadas_tours);////        //////////////////////////////////////////////////////////////////////////////        //SPECIAL/////////////////////////////////////////////////////////////////////        $sql_spcida = "SELECT (sum(pax) + sum(pax2))as tari_spc//                                FROM  reservas //                                Where trip_no = '$trip_no' AND fecha_salida = '$fecha_ini1' AND id1 = '6' AND estado != 'QUOTE' AND estado != 'CANCELED' AND estado != 'NOT SHOW W/ CHARGE' AND estado != 'NOT SHOW W/O CHARGE'";//        $rs_spcida = Doo::db()->query($sql_spcida, array($trip_no, $fecha_ini1));//        $r_spcida = $rs_spcida->fetchAll();//        $spc_seats_ida = $r_spcida[0]['tari_spc'] ? $r_spcida[0]['tari_spc'] : 0;////////        $sql_spcretorno = "SELECT (sum(pax) + sum(pax2))as tari_spc//                                FROM  reservas //                                Where trip_no2 = '$trip_no' AND fecha_retorno = '$fecha_fin1' AND id2 = '6' AND estado != 'QUOTE' AND estado != 'CANCELED' AND estado != 'NOT SHOW W/ CHARGE' AND estado != 'NOT SHOW W/O CHARGE'";//        $rs_spcretorno = Doo::db()->query($sql_spcretorno, array($trip_no, $fecha_fin1));//        $r_spcretorno = $rs_spcretorno->fetchAll();//        $spc_seats_retorno = $r_spcretorno[0]['tari_spc'] ? $r_spcretorno[0]['tari_spc'] : 0;////        $special_total = $spc_seats_ida + $spc_seats_retorno;//////        //        //        //        $sqlIda1 = "SELECT (sum(pax) + sum(pax2))as ocupadas//                        FROM  reservas //                        Where trip_no = '$trip_no' AND fecha_salida = '$fecha_ini1' AND estado != 'QUOTE' AND estado != 'CANCELED' AND estado != 'NOT SHOW W/ CHARGE' AND estado != 'NOT SHOW W/O CHARGE'";//        $rsida = Doo::db()->query($sqlIda1, array($trip_no, $fecha_ini1));//        $r_idas1 = $rsida->fetchAll();//        $ocupadasida = $r_idas1[0]['ocupadas'] ? $r_idas1[0]['ocupadas'] : 0;////        $sqlRetunr1 = "SELECT (sum(pax) + sum(pax2))as ocupadas//                                FROM  reservas //                                Where trip_no2 = '$trip_no' AND fecha_retorno = '$fecha_fin1' AND estado != 'QUOTE' AND estado != 'CANCELED' AND estado != 'NOT SHOW W/ CHARGE' AND estado != 'NOT SHOW W/O CHARGE'";//        $rsregreso = Doo::db()->query($sqlRetunr1, array($trip_no, $fecha_fin1));//        $r_return1 = $rsregreso->fetchAll();//        $ocupadasreturn = $r_return1[0]['ocupadas'] ? $r_return1[0]['ocupadas'] : 0;////        $ocupadas1 = $ocupadasida + $ocupadasreturn;////        $capacidadz = 57;//        $cupon = $capacidadz - $ocupadas1; //        //echo $cupon;//        //        $sold = $standard_total + $superflex_total + $tours_total + $special_total;//        //echo $sold;////     //    }        public function edit() {        $item = $_POST['item'];        $acompany = $_POST['acompany'];        $type_rate = $_POST['type_rate'];        $identificador = $_POST['identificador'];        $mes1 = $_REQUEST['mes1'];        $anio = $_REQUEST['anio1'];        $date1 = $_REQUEST['fecha_ini'];        $date2 = $_REQUEST['fecha_fin'];        Doo::loadModel("Routes");        Doo::loadModel("Agency");        Doo::loadModel("Routes_Net");        $k = explode(":", $this->params["pindex"]);        if ($k[1] == "2") {            $trip = new Routes_Net();            $agency = new Agency();//            $type_rate=2;        } else {            $trip = new Routes();//            $type_rate=0;        }        $this->data['item'] = $item;        $this->data['mes'] = $mes1;        $this->data['anio'] = $anio;        $this->data['acompany'] = $acompany;        $this->data['fecha_ini'] = $date1;        $this->data['fecha_fin'] = $date2;        $trip->id = $k[0];        $this->data['rootUrl'] = Doo::conf()->APP_URL;        $this->data['trip'] = Doo::db()->find($trip, array('limit' => 1));        $this->data['areas'] = Doo::db()->find("Areas", array("asArray" => true));        $this->data['tripsnumber'] = Doo::db()->find("Trips", array("asArray" => true));        $agency = new Agency();        $agency->id = $this->data['trip']->id_agency;        $this->data['agency'] = Doo::db()->find($agency, array('limit' => 1));        $this->data['trip']->type_rate == 2;        //$type_rate = 2;        //if ($this->data['trip']->type_rate == 2) {        if ($type_rate == 2) {            //$this->data['content'] = 'configuracion/frm_route _special.php';            if ($item == 100 || $item == 200 || $item == 300) {                $this->data['content'] = 'configuracion/frm_route_special.php';                //echo $type_rate;            }            if ($item == 101 || $item == 201 || $item == 301) {                $this->data['content'] = 'configuracion/frm_retorno_special.php';            }            $this->data['dato'] = "edit";            $this->view()->renderc('admin/index', $this->data);        }        if ($type_rate == 0) {            //$this->data['content'] = 'configuracion/frm_route.php';            if ($item == 100 || $item == 200 || $item == 300) {                $this->data['content'] = 'configuracion/frm_route.php';                //echo $type_rate;            }            if ($item == 101 || $item == 201 || $item == 301) {                $this->data['content'] = 'configuracion/frm_retorno.php';            }            $this->data['dato'] = "edit";            $this->view()->renderc('admin/index', $this->data);        }    }    public function delete() {        Doo::loadModel("Routes");        Doo::loadModel("Routes_Net");        $k = explode(":", $_REQUEST['item']);        if ($k[1] == "2") {            $trip = new Routes_Net();        } else {            $trip = new Routes();        }        $trip->id = $k[0];        Doo::db()->delete($trip);        return Doo::conf()->APP_URL . "admin/routes/" . $k[1];    }    public function trip_from() {        $trip = $this->params['trip'];        $sql = "SELECT DISTINCT a.id, a.nombre		 			FROM   `areas`  a LEFT JOIN `routes` r ON (a.id = r.trip_from)		 			WHERE  trip_no = ? Order By a.`nombre` ASC ";        $rs = Doo::db()->query($sql, array($trip));        $area = $rs->fetchAll();        echo "<option value='0'>Select Option</option>";        echo "<option value='*'>\"ALL POINTS OF DEPARTURE\"</option>";        foreach ($area as $e) {            echo "<option value='" . $e["id"] . "'>" . $e["nombre"] . "</option>";        }    }    public function trip_to() {        $trip = $this->params['trip'];        $from = $this->params['from'];        echo $sql = "SELECT DISTINCT a.id, a.nombre		 			FROM   `areas`  a LEFT JOIN `routes` r ON (a.id = r.trip_to)		 			WHERE  r.trip_no = ?  AND r.trip_from = ? Order By a.`nombre` ASC ";        $rs = Doo::db()->query($sql, array($trip, $from));        $area = $rs->fetchAll();        echo "<option value='0'>Select Option</option>";        if (count($area) > 0) {            echo "<option value='*'>\"ALL POINTS OF ARRIVAL\"</option>";        }        foreach ($area as $e) {            echo "<option value='" . $e["id"] . "'>" . $e["nombre"] . " </option>";        }    }            public function actualizarDato(){                        $trip_no = $this->params['trip_no'];        $fecha_ini = $this->params['fecha_ini'];        $fecha_fin = $this->params['fecha_fin'];               $trip_from = $this->params['trip_from'];        $trip_to = $this->params['trip_to'];               $departureTime = $this->params['departureTime'];        $arrivalTime = $this->params['arrivalTime'];                Doo::db()->query("UPDATE routes SET  trip_departure='$departureTime', trip_arrival='$arrivalTime'  WHERE trip_no ='$trip_no' AND trip_from ='$trip_from' AND trip_to ='$trip_to' AND fecha_ini >='$fecha_ini' AND fecha_fin <= '$fecha_fin' AND type_rate = '0'");                Doo::db()->query("UPDATE routes_net SET  trip_departure='$departureTime', trip_arrival='$arrivalTime'  WHERE trip_no ='$trip_no' AND trip_from ='$trip_from' AND trip_to ='$trip_to' AND fecha_ini >='$fecha_ini' AND fecha_fin <= '$fecha_fin' AND type_rate = '2'");                echo "<br>";                echo '<span style="color:red; text-align:center; font-size:10px;">Actualizado</span>';    }}